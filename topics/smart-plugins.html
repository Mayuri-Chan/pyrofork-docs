<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Plugins &mdash; Pyrogram Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="canonical" href="https://docs.pyrogram.org/topics/smart-plugins.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Storage Engines" href="storage-engines.html" />
    <link rel="prev" title="Synchronous Usage" href="synchronous.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Pyrogram
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/install.html">Install Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../start/setup.html">Project Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/auth.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/invoking.html">Invoking Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/updates.html">Handling Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/errors.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/examples/index.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/client.html">Pyrogram Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/methods/index.html">Available Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/types/index.html">Available Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/bound-methods/index.html">Bound Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/enums/index.html">Enumerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/handlers.html">Update Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/decorators.html">Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/errors/index.html">RPC Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/filters.html">Update Filters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Topic Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="use-filters.html">Using Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="create-filters.html">Creating Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="more-on-updates.html">More on Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="client-settings.html">Client Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="speedups.html">Speedups</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-formatting.html">Text Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="synchronous.html">Synchronous Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Smart Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-smart-plugins">Using Smart Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specifying-the-plugins-to-include">Specifying the Plugins to include</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#load-unload-plugins-at-runtime">Load/Unload Plugins at Runtime</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unloading">Unloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading">Loading</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="storage-engines.html">Storage Engines</a></li>
<li class="toctree-l1"><a class="reference internal" href="serializing.html">Object Serialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="mtproto-vs-botapi.html">MTProto vs. Bot API</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="test-servers.html">Test Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced-usage.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="voice-calls.html">Voice Calls</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support Pyrogram</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Telegram Raw API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../telegram/functions/index.html">Raw Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../telegram/types/index.html">Raw Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../telegram/base/index.html">Raw Base</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pyrogram</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Smart Plugins</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="smart-plugins">
<h1>Smart Plugins<a class="headerlink" href="#smart-plugins" title="Permalink to this heading"></a></h1>
<p>Pyrogram embeds a smart, lightweight yet powerful plugin system that is meant to further simplify the organization
of large projects and to provide a way for creating pluggable (modular) components that can be easily shared across
different Pyrogram applications with minimal boilerplate code.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Smart Plugins are completely optional and disabled by default.</p>
</div>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#using-smart-plugins" id="id2">Using Smart Plugins</a></p></li>
<li><p><a class="reference internal" href="#specifying-the-plugins-to-include" id="id3">Specifying the Plugins to include</a></p></li>
<li><p><a class="reference internal" href="#load-unload-plugins-at-runtime" id="id4">Load/Unload Plugins at Runtime</a></p></li>
</ul>
</div>
<hr class="docutils" />
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>Prior to the Smart Plugin system, pluggable handlers were already possible. For example, if you wanted to modularize
your applications, you had to put your function definitions in separate files and register them inside your main script
after importing your modules, like this:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is an example application that replies in private chats with two messages: one containing the same
text message you sent and the other containing the reversed text message.</p>
<p>Example: <em>“Pyrogram”</em> replies with <em>“Pyrogram”</em> and <em>“margoryP”</em></p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>myproject/
    handlers.py
    main.py
</pre></div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">handlers.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">echo_reversed</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">filters</span>
<span class="kn">from</span> <span class="nn">pyrogram.handlers</span> <span class="kn">import</span> <span class="n">MessageHandler</span>

<span class="kn">from</span> <span class="nn">handlers</span> <span class="kn">import</span> <span class="n">echo</span><span class="p">,</span> <span class="n">echo_reversed</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span>
    <span class="n">MessageHandler</span><span class="p">(</span>
        <span class="n">echo</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">filters</span><span class="o">.</span><span class="n">private</span><span class="p">))</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span>
    <span class="n">MessageHandler</span><span class="p">(</span>
        <span class="n">echo_reversed</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">filters</span><span class="o">.</span><span class="n">private</span><span class="p">),</span>
    <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>This is already nice and doesn’t add <em>too much</em> boilerplate code, but things can get boring still; you have to
manually <code class="docutils literal notranslate"><span class="pre">import</span></code>, manually <a class="reference internal" href="../api/methods/add_handler.html#pyrogram.Client.add_handler" title="pyrogram.Client.add_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_handler()</span></code></a> and manually instantiate each
<a class="reference internal" href="../api/handlers.html#pyrogram.handlers.MessageHandler" title="pyrogram.handlers.MessageHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">MessageHandler</span></code></a> object because you can’t use decorators for your functions.
So, what if you could? Smart Plugins solve this issue by taking care of handlers registration automatically.</p>
</section>
<section id="using-smart-plugins">
<h2>Using Smart Plugins<a class="headerlink" href="#using-smart-plugins" title="Permalink to this heading"></a></h2>
<p>Setting up your Pyrogram project to accommodate Smart Plugins is pretty straightforward:</p>
<ol class="arabic simple">
<li><p>Create a new folder to store all the plugins (e.g.: “plugins”, “handlers”, …).</p></li>
<li><p>Put your python files full of plugins inside. Organize them as you wish.</p></li>
<li><p>Enable plugins in your Client.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the same example application as shown above, written using the Smart Plugin system.</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>myproject/
    plugins/
        handlers.py
    main.py
</pre></div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">plugins/handlers.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">filters</span>


<span class="nd">@Client</span><span class="o">.</span><span class="n">on_message</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">filters</span><span class="o">.</span><span class="n">private</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


<span class="nd">@Client</span><span class="o">.</span><span class="n">on_message</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">filters</span><span class="o">.</span><span class="n">private</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">echo_reversed</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>The first important thing to note is the new <code class="docutils literal notranslate"><span class="pre">plugins</span></code> folder. You can put <em>any python file</em> in <em>any subfolder</em> and
each file can contain <em>any decorated function</em> (handlers) with one limitation: within a single module (file) you must
use different names for each decorated function.</p>
<p>The second thing is telling Pyrogram where to look for your plugins: you can use the Client parameter “plugins”;
the <em>root</em> value must match the name of your plugins root folder. Your Pyrogram Client instance will <strong>automatically</strong>
scan the folder upon starting to search for valid handlers and register them for you.</p>
<p>Then you’ll notice you can now use decorators. That’s right, you can apply the usual decorators to your callback
functions in a static way, i.e. <strong>without having the Client instance around</strong>: simply use <code class="docutils literal notranslate"><span class="pre">&#64;Client</span></code> (Client class)
instead of the usual <code class="docutils literal notranslate"><span class="pre">&#64;app</span></code> (Client instance) and things will work just the same.</p>
</section>
<section id="specifying-the-plugins-to-include">
<h2>Specifying the Plugins to include<a class="headerlink" href="#specifying-the-plugins-to-include" title="Permalink to this heading"></a></h2>
<p>By default, if you don’t explicitly supply a list of plugins, every valid one found inside your plugins root folder will
be included by following the alphabetical order of the directory structure (files and subfolders); the single handlers
found inside each module will be, instead, loaded in the order they are defined, from top to bottom.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember: there can be at most one handler, within a group, dealing with a specific update. Plugins with overlapping
filters included a second time will not work, by design. Learn more at <a class="reference internal" href="more-on-updates.html"><span class="doc">More on Updates</span></a>.</p>
</div>
<p>This default loading behaviour is usually enough, but sometimes you want to have more control on what to include (or
exclude) and in which exact order to load plugins. The way to do this is to make use of <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude</span></code>
directives in the dictionary passed as Client argument. Here’s how they work:</p>
<ul class="simple">
<li><p>If both <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude</span></code> are omitted, all plugins are loaded as described above.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">include</span></code> is given, only the specified plugins will be loaded, in the order they are passed.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">exclude</span></code> is given, the plugins specified here will be unloaded.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude</span></code> value is a <strong>list of strings</strong>. Each string containing the path of the module relative
to the plugins root folder, in Python notation (dots instead of slashes).</p>
<blockquote>
<div><p>E.g.: <code class="docutils literal notranslate"><span class="pre">subfolder.module</span></code> refers to <code class="docutils literal notranslate"><span class="pre">plugins/subfolder/module.py</span></code>, with <code class="docutils literal notranslate"><span class="pre">root=&quot;plugins&quot;</span></code>.</p>
</div></blockquote>
<p>You can also choose the order in which the single handlers inside a module are loaded, thus overriding the default
top-to-bottom loading policy. You can do this by appending the name of the functions to the module path, each one
separated by a blank space.</p>
<blockquote>
<div><p>E.g.: <code class="docutils literal notranslate"><span class="pre">subfolder.module</span> <span class="pre">fn2</span> <span class="pre">fn1</span> <span class="pre">fn3</span></code> will load <em>fn2</em>, <em>fn1</em> and <em>fn3</em> from <em>subfolder.module</em>, in this order.</p>
</div></blockquote>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this heading"></a></h3>
<p>Given this plugins folder structure with three modules, each containing their own handlers (fn1, fn2, etc…), which are
also organized in subfolders:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>myproject/
    plugins/
        subfolder1/
            plugins1.py
                - fn1
                - fn2
                - fn3
        subfolder2/
            plugins2.py
                ...
        plugins0.py
            ...
    ...
</pre></div>
</div>
<ul>
<li><p>Load every handler from every module, namely <em>plugins0.py</em>, <em>plugins1.py</em> and <em>plugins2.py</em> in alphabetical order
(files) and definition order (handlers inside files):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Load only handlers defined inside <em>plugins2.py</em> and <em>plugins0.py</em>, in this order:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
    <span class="n">include</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;subfolder2.plugins2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plugins0&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Load everything except the handlers inside <em>plugins2.py</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
    <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subfolder2.plugins2&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Load only <em>fn3</em>, <em>fn1</em> and <em>fn2</em> (in this order) from <em>plugins1.py</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
    <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subfolder1.plugins1 fn3 fn1 fn2&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="load-unload-plugins-at-runtime">
<h2>Load/Unload Plugins at Runtime<a class="headerlink" href="#load-unload-plugins-at-runtime" title="Permalink to this heading"></a></h2>
<p>In the previous section we’ve explained how to specify which plugins to load and which to ignore before your Client
starts. Here we’ll show, instead, how to unload and load again a previously registered plugin at runtime.</p>
<p>Each function decorated with the usual <code class="docutils literal notranslate"><span class="pre">on_message</span></code> decorator (or any other decorator that deals with Telegram
updates) will be modified in such a way that a special <code class="docutils literal notranslate"><span class="pre">handlers</span></code> attribute pointing to a list of tuples of
<em>(handler: Handler, group: int)</em> is attached to the function object itself.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">plugins/handlers.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@Client</span><span class="o">.</span><span class="n">on_message</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">filters</span><span class="o">.</span><span class="n">private</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">echo</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">echo</span><span class="o">.</span><span class="n">handlers</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Printing <code class="docutils literal notranslate"><span class="pre">echo</span></code> will show something like <code class="docutils literal notranslate"><span class="pre">&lt;function</span> <span class="pre">echo</span> <span class="pre">at</span> <span class="pre">0x10e3b6598&gt;</span></code>.</p></li>
<li><p>Printing <code class="docutils literal notranslate"><span class="pre">echo.handlers</span></code> will reveal the handlers, that is, a list of tuples containing the actual handlers and
the groups they were registered on <code class="docutils literal notranslate"><span class="pre">[(&lt;MessageHandler</span> <span class="pre">object</span> <span class="pre">at</span> <span class="pre">0x10e3abc50&gt;,</span> <span class="pre">0)]</span></code>.</p></li>
</ul>
<section id="unloading">
<h3>Unloading<a class="headerlink" href="#unloading" title="Permalink to this heading"></a></h3>
<p>In order to unload a plugin, all you need to do is obtain a reference to it by importing the relevant module and call
<a class="reference internal" href="../api/methods/remove_handler.html#pyrogram.Client.remove_handler" title="pyrogram.Client.remove_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_handler()</span></code></a> Client’s method with your function’s <em>handler</em> instance:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plugins.handlers</span> <span class="kn">import</span> <span class="n">echo</span>

<span class="n">handlers</span> <span class="o">=</span> <span class="n">echo</span><span class="o">.</span><span class="n">handlers</span>

<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">remove_handler</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>The star <code class="docutils literal notranslate"><span class="pre">*</span></code> operator is used to unpack the tuple into positional arguments so that <em>remove_handler</em> will receive
exactly what is needed. The same could have been achieved with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">handlers</span> <span class="o">=</span> <span class="n">echo</span><span class="o">.</span><span class="n">handlers</span>
<span class="n">handler</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">app</span><span class="o">.</span><span class="n">remove_handler</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="loading">
<h3>Loading<a class="headerlink" href="#loading" title="Permalink to this heading"></a></h3>
<p>Similarly to the unloading process, in order to load again a previously unloaded plugin you do the same, but this time
using <a class="reference internal" href="../api/methods/add_handler.html#pyrogram.Client.add_handler" title="pyrogram.Client.add_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_handler()</span></code></a> instead. Example:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plugins.handlers</span> <span class="kn">import</span> <span class="n">echo</span>

<span class="o">...</span>

<span class="n">handlers</span> <span class="o">=</span> <span class="n">echo</span><span class="o">.</span><span class="n">handlers</span>

<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="synchronous.html" class="btn btn-neutral float-left" title="Synchronous Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="storage-engines.html" class="btn btn-neutral float-right" title="Storage Engines" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>