<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating Filters &mdash; Pyrogram Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="canonical" href="https://docs.pyrogram.org/topics/create-filters.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="More on Updates" href="more-on-updates.html" />
    <link rel="prev" title="Using Filters" href="use-filters.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Pyrogram
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/install.html">Install Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../start/setup.html">Project Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/auth.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/invoking.html">Invoking Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/updates.html">Handling Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/errors.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/examples/index.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/client.html">Pyrogram Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/methods/index.html">Available Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/types/index.html">Available Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/bound-methods/index.html">Bound Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/enums/index.html">Enumerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/handlers.html">Update Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/decorators.html">Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/errors/index.html">RPC Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/filters.html">Update Filters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Topic Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="use-filters.html">Using Filters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating Filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#custom-filters">Custom Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-filters">Basic Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filters-with-arguments">Filters with Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#method-calls-inside-filters">Method Calls Inside Filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="more-on-updates.html">More on Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="client-settings.html">Client Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="speedups.html">Speedups</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-formatting.html">Text Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="synchronous.html">Synchronous Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="smart-plugins.html">Smart Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage-engines.html">Storage Engines</a></li>
<li class="toctree-l1"><a class="reference internal" href="serializing.html">Object Serialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="mtproto-vs-botapi.html">MTProto vs. Bot API</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="test-servers.html">Test Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced-usage.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="voice-calls.html">Voice Calls</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support Pyrogram</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Telegram Raw API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../telegram/functions/index.html">Raw Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../telegram/types/index.html">Raw Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../telegram/base/index.html">Raw Base</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pyrogram</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Creating Filters</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-filters">
<h1>Creating Filters<a class="headerlink" href="#creating-filters" title="Permalink to this heading"></a></h1>
<p>Pyrogram already provides lots of built-in <a class="reference internal" href="../api/filters.html#module-pyrogram.filters" title="pyrogram.filters"><code class="xref py py-class docutils literal notranslate"><span class="pre">filters</span></code></a> to work with, but in case you can’t find a
specific one for your needs or want to build a custom filter by yourself you can use
<a class="reference internal" href="../api/filters.html#pyrogram.filters.create" title="pyrogram.filters.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">filters.create()</span></code></a>.</p>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#custom-filters" id="id1">Custom Filters</a></p></li>
<li><p><a class="reference internal" href="#basic-filters" id="id2">Basic Filters</a></p></li>
<li><p><a class="reference internal" href="#filters-with-arguments" id="id3">Filters with Arguments</a></p></li>
<li><p><a class="reference internal" href="#method-calls-inside-filters" id="id4">Method Calls Inside Filters</a></p></li>
</ul>
</div>
<hr class="docutils" />
<section id="custom-filters">
<h2>Custom Filters<a class="headerlink" href="#custom-filters" title="Permalink to this heading"></a></h2>
<p>An example to demonstrate how custom filters work is to show how to create and use one for the
<a class="reference internal" href="../api/handlers.html#pyrogram.handlers.CallbackQueryHandler" title="pyrogram.handlers.CallbackQueryHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">CallbackQueryHandler</span></code></a>. Note that callback queries updates are only received by bots as result
of a user pressing an inline button attached to the bot’s message; create and <a class="reference internal" href="../start/auth.html"><span class="doc">authorize your bot</span></a>,
then send a message with an inline keyboard to yourself. This allows you to test your filter by pressing the inline
button:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram.types</span> <span class="kn">import</span> <span class="n">InlineKeyboardMarkup</span><span class="p">,</span> <span class="n">InlineKeyboardButton</span>

<span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
    <span class="s2">&quot;username&quot;</span><span class="p">,</span>  <span class="c1"># Change this to your username or id</span>
    <span class="s2">&quot;Pyrogram custom filter test&quot;</span><span class="p">,</span>
    <span class="n">reply_markup</span><span class="o">=</span><span class="n">InlineKeyboardMarkup</span><span class="p">(</span>
        <span class="p">[[</span><span class="n">InlineKeyboardButton</span><span class="p">(</span><span class="s2">&quot;Press me&quot;</span><span class="p">,</span> <span class="s2">&quot;pyrogram&quot;</span><span class="p">)]]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="basic-filters">
<h2>Basic Filters<a class="headerlink" href="#basic-filters" title="Permalink to this heading"></a></h2>
<p>For this basic filter we will be using only the first parameter of <a class="reference internal" href="../api/filters.html#pyrogram.filters.create" title="pyrogram.filters.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code></a>.</p>
<p>The heart of a filter is its callback function, which accepts three arguments <em>(self, client, update)</em> and returns
either <code class="docutils literal notranslate"><span class="pre">True</span></code>, in case you want the update to pass the filter or <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<p>In this example we are matching the query data to “pyrogram”, which means that the filter will only allow callback
queries containing “pyrogram” as data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">filters</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;pyrogram&quot;</span>

<span class="n">static_data_filter</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</pre></div>
</div>
<p>The first two arguments of the callback function are unused here and because of this we named them using underscores.</p>
<p>Finally, the filter usage remains the same:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">on_callback_query</span><span class="p">(</span><span class="n">static_data_filter</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">pyrogram_data</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="n">query</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span><span class="s2">&quot;it works!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="filters-with-arguments">
<h2>Filters with Arguments<a class="headerlink" href="#filters-with-arguments" title="Permalink to this heading"></a></h2>
<p>A more flexible filter would be one that accepts “pyrogram” or any other string as argument at usage time.
A dynamic filter like this will make use of named arguments for the <a class="reference internal" href="../api/filters.html#pyrogram.filters.create" title="pyrogram.filters.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code></a> method and the
first argument of the callback function, which is a reference to the filter object itself holding the extra data passed
via named arguments.</p>
<p>This is how a dynamic custom filter looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">filters</span>

<span class="k">def</span> <span class="nf">dynamic_data_filter</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">flt</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">query</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># &quot;data&quot; kwarg is accessed with &quot;flt.data&quot; above</span>
    <span class="k">return</span> <span class="n">filters</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>And finally its usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">on_callback_query</span><span class="p">(</span><span class="n">dynamic_data_filter</span><span class="p">(</span><span class="s2">&quot;pyrogram&quot;</span><span class="p">))</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">pyrogram_data</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="n">query</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span><span class="s2">&quot;it works!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="method-calls-inside-filters">
<h2>Method Calls Inside Filters<a class="headerlink" href="#method-calls-inside-filters" title="Permalink to this heading"></a></h2>
<p>The missing piece we haven’t covered yet is the second argument of a filter callback function, namely, the <code class="docutils literal notranslate"><span class="pre">client</span></code>
argument. This is a reference to the <a class="reference internal" href="../api/client.html#pyrogram.Client" title="pyrogram.Client"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Client</span></code></a> instance that is running the filter and it is useful in
case you would like to make some API calls before deciding whether the filter should allow the update or not:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="c1"># r = await client.some_api_method()</span>
    <span class="c1"># check response &quot;r&quot; and decide to return True or False</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="use-filters.html" class="btn btn-neutral float-left" title="Using Filters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="more-on-updates.html" class="btn btn-neutral float-right" title="More on Updates" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>